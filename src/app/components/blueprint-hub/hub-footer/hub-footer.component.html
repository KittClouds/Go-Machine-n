<div
    class="h-8 bg-gradient-to-r from-[#115e59] via-[#134e4a] to-[#0f172a] text-slate-200 border-t border-teal-900/40 flex items-center justify-between px-3 text-xs select-none z-50 relative shadow-[0_-1px_3px_rgba(0,0,0,0.05)]">
    <!-- Left: Hub Trigger -->
    <div class="flex items-center gap-4">
        <!-- Hub Toggle -->
        <button (click)="hubService.toggle()" class="flex items-center gap-2 transition-colors focus:outline-none group"
            [class.text-white]="hubService.isHubOpen()" [class.font-semibold]="hubService.isHubOpen()"
            [class.text-white/80]="!hubService.isHubOpen()" [class.hover:text-white]="true">
            <i class="pi" [class.pi-angle-up]="!hubService.isHubOpen()"
                [class.pi-angle-down]="hubService.isHubOpen()"></i>

            <span class="flex items-center gap-1.5">
                <i class="pi pi-database text-[10px]"></i>
                Hub
            </span>
            <span class="ml-1 opacity-70 group-hover:opacity-100 transition-opacity">{{ statsService.totalEntities() }}
                entities</span>
        </button>

        <div class="h-3 w-[1px] bg-white/20"></div>

        <!-- TTS Settings Popup -->
        <app-tts-settings-popup></app-tts-settings-popup>

        <!-- TTS Controls -->
        @switch (ttsService.modelState()) {
        @case ('idle') {
        <button (click)="onLoadModelClick()"
            class="text-white/80 hover:text-white transition-colors flex items-center gap-1"
            title="Load Text-to-Speech Model">
            <i class="pi pi-download text-[10px]"></i>
        </button>
        }
        @case ('loading') {
        <button disabled class="text-teal-400 flex items-center gap-1 cursor-wait" title="Loading TTS model...">
            <i class="pi pi-spin pi-spinner text-[10px]"></i>
            <span class="text-[10px]">{{ ttsService.loadProgress() }}%</span>
        </button>
        }
        @case ('ready') {
        <button (click)="onSpeakClick()" class="transition-colors flex items-center gap-1"
            [class.text-teal-400]="ttsService.isPlaying()" [class.text-white/80]="!ttsService.isPlaying()"
            [class.hover:text-white]="!ttsService.isPlaying()"
            [title]="ttsService.isPlaying() ? 'Stop reading' : 'Read note aloud'">
            <i class="pi text-[10px]" [class.pi-volume-up]="!ttsService.isPlaying()"
                [class.pi-stop]="ttsService.isPlaying()"></i>
        </button>
        }
        @case ('error') {
        <button (click)="onLoadModelClick()"
            class="text-red-400 hover:text-red-300 transition-colors flex items-center gap-1"
            title="Load failed - click to retry">
            <i class="pi pi-exclamation-triangle text-[10px]"></i>
        </button>
        }
        }
    </div>

    <!-- Right: Editor Stats (LIVE DATA) -->
    <div class="flex items-center gap-4 text-white/70">
        <span class="hover:text-white cursor-pointer transition-colors">{{ statsService.backlinks() }} backlinks</span>
        <span class="hover:text-white cursor-pointer transition-colors">{{ statsService.wordCount() }} words</span>
        <om-gradient-text [text]="charCountText()" [gradientStart]="charGradientStart()"
            [gradientEnd]="charGradientEnd()" styleClass="char-health-gradient">
        </om-gradient-text>
        <span>{{ statsService.totalNotes() }} notes</span>

        <!-- Save Status -->
        <button *ngIf="statsService.isSaved()"
            class="flex items-center gap-1 px-2 py-0.5 rounded-full bg-teal-900/30 border border-teal-400/30 text-teal-100 hover:bg-teal-900/50 transition-colors">
            <i class="pi pi-check text-[10px]"></i>
            <span>Saved</span>
        </button>
        <button *ngIf="!statsService.isSaved()"
            class="flex items-center gap-1 px-2 py-0.5 rounded-full bg-yellow-500/10 border border-yellow-500/30 text-yellow-100 transition-colors">
            <i class="pi pi-sync text-[10px] animate-spin"></i>
            <span>Saving...</span>
        </button>
    </div>
</div>